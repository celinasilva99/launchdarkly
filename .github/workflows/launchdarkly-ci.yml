name: Deploy and Toggle Feature Flag

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
        
      - name: Grant execution permission for deploy.sh
        run: chmod +x deploy.sh

      - name: Run Deployment Script
        run: ./deploy.sh


      - name: Enable Feature in LaunchDarkly
        run: |
          curl -X PATCH "https://app.launchdarkly.com/api/v2/flags/${{ secrets.PROJECT_KEY }}/${{ secrets.FEATURE_FLAG_KEY }}" \
          -H "Authorization: Bearer ${{ secrets.LAUNCHDARKLY_API_KEY }}" \
          -H "Content-Type: application/json" \
          -d '{"on": true}'
